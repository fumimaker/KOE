/*
 
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMF   TMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMB^   ?MMMMMMMMMM
MMMMMMMMMt       ?WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM"!       4MMMMMMMMM
MMMMMMMMF           ?WMMMMMMW""!`              ?""HMMMMMM#"`           MMMMMMMMM
MMMMMMMM:              ?^                            -""               (MMMMMMMM
MMMMMMMM.                                                              ,MMMMMMMM
MMMMMMMM|                                                              (MMMMMMMM
MMMMMMMMN                                                             .MMMMMMMMM
MMMMMMMMMN.                                                          .MMMMMMMMMM
MMMMMMMMMMMa.                                                       .MMMMMMMMMMM
MMMMMMMMMMMD                                                        ?MMMMMMMMMMM
MMMMMMMMMM3                                                          ,MMMMMMMMMM
MMMMMMMMM%                       ...gNNMMNNgJ..                       .MMMMMMMMM
MMMMMMMMF                     .gMMMMMMMMMMMMMMMMa,                     ,MMMMMMMM
MMMMMMM#                    .MMMMMMMMMMMMMMMMMMMMMN,                    dMMMMMMM
MMMMMMM%                  .MMMMMMMMMMH""HMMMMMMMMMMMN.                   MMMMMMM
MMMMMM#                  .MMMMMMMD!         ?WMMMMMMMN.                  JMMMMMM
MMMMMMF                  MMMMMMD              ,MMMMMMMb                  .MMMMMM
MMMMMM]                 .MMMMMF                .MMMMMMM,                  MMMMMM
MMMMMM%                 (MMMMM\                 JMMMMMM]                  MMMMMM
MMMMMM]                 (MMMMM)                 .MMMMMMF                  dMMMMM
MMMMMM]                 .MMMMM%                 .MMMMMM]                  dMMMMM
MMMMMMb                  ."MM"                  .MMMMMM!                  MMMMMM
MMMMMMN                                         (MMMMMD                  .MMMMMM
MMMMMMM[                                       .MMMMB`                   -MMMMMM
MMMMMMMN,                                      JMMMF                     MMMMMMM
MMMMMMMMN.                                    -MMMM`                    -MMMMMMM
MMMMMMMMMN,                                  JMMMM#                    .MMMMMMMM
MMMMMMMMMMMa.                              .MMMMMMM,                  .MMMMMMMMM
MMMMMMMMMMMMMa.                          .dMMMMMMMMN.                .MMMMMMMMMM
MMMMMMMMMMMMMMMN,.                    ..MMMMMMMMMMMMN,             .MMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMN-..          ...gMMMMMMMMMMMMMMMMMNJ.       .+MMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
*
*yyZyyZyyZyyZyyZyyZyyZyyXdNMNZWgNMNyZyyZyyZyyZyyZyyZyyZyyZQMNMMygMHyyZyyZQMMyyyZy
yZyyZyyZyyZyyZyyZyyZyZXMMMMMMR~dNyZyyZyyZydMyZyyZyyZyyyQMNMMQMMWyyZyyXgMHyyZyZyy
ZyyZyZyyZyyZyyZyyZyyZyXMMMMMBM2(TMyZyyZyQMWZyZyZyZV=?7BNMHQMMyyZyyyQMMyyZyyZyyZX
yZyyZyZyZyZyZyZyZyZyyZXMMMM8<db_-(KZyZQMHyZyZyyZyY .Na,  .... 4ZY7"WV7TXVyZyXgMN
yZyZyyyZyyZyyZyyZyyZyyZZHNNkHQD~~dyyXHHyyZyyZyZf'.JMMMMMNMMdB . .g,  JJ,....4NMH
yyZyZyZyyZXkWHHHHHHHHMHHWMMkXK~-+HZWMyyZyyZyyf`.+MMMS/?7MMM%.Mb TMMNMMMNMMN., yy
ZyyZyZyZXWHWWWVT!~~~~~~~~&J<dkQHkXyyZyZyZyZyQM. TM"dMMNMMM=.M# ..,TMMMNMMMMM%.NZ
yZyyZyXWWyW9>~(<~~~~~~~~~O_~~~(?WwqkyZyyZyyXNMWK_   .MMM#!.MM$ MMM#jMMWMMMM@ MMy
yZyZyWHyX3~_(<~~~~~~~~_JVO>~~~~<-?kHNkyZyXMMWyS (gMMMM#^.gMMy0- dMFdM#MMMMM] MNM
yyZyKWX=_J<+<~~~~~-~~JY<~j1~~~~~__?kHHyyUHyZyyyn.?M9^..MMMHyX .gMMNMMMMMMMMF MMM
ZyyWWYiJ=~(~~~~~~~~(J<(<._I/_-~_.-.qUHkyyyZyZZyZ$..gM^. ?TQMH;.M"TMMMMMMNNN@ dZy
yXV6+Z<~~<~~~~~-~~(<~J8~~~j1({~~_z~(MWHZyZyyy0=`.J.?`.MMN`.Zf^ NN[   (&Z"""!.MHZ
WHHY<~~~~~~~_&z~~(v~J<$-~~JRdl~~~+(~zWHyZyZyZn 7MMMm-MMM'.MN`.gMMm.MNjMMgJ,,MMyy
HV<~~~~~~~~~JuC~~J~(_+C_jx~fZ$~~~+(j(WyZyyZyyyZ, ?MMMM@ (MMy.(UMMMkMNdM#TW:.NyyZ
=~~~~~~~~~~(rW~~(E(@TQKWH:?Z(y_~~j((I?NyZyyV7! .(MMMMMMe Ty% gMMM@M#MMMMMM%.NyZy
~~~~~~~~~~(yh1~_Zz> MMMH\1~:.w4-~dJ(Ne?kyZy-.MMMMM@'.WMMD y} "MM#dMMdM#HMe JMZyy
~~~~~~~~_+yWHl~(!~``?Cw\ ```(k,?&Wf(#XHdkyZy; T"!..MR 7..MM ..MM%?",WNMNMY.dkyZy
~~~~~~~(dyWM9~~v..`````````.#0<jdW$(#yyyZyy!..  ??^"?7?T"9y ,MMM MMMMMB=.(MMHyyZ
~~~~.~(XyWMH3:(\`` ````````.4D(MdyljyyZyyZr dMMMMMMMNNNg| yn...., `...JMMMHyyZyy
~~~~(uyWMMM8J>(l```.(1i-. ` dW#WHW<dyZQQQXm.???7jMMMMMMM\.NyyZyyyyUMMMHyyyyZyZZy
~~(dHWNMMMNZvr(vi. 1+;;OA=`.NWZQWK(HXXQQQHHMZV .MMM".MkM[.MyZyyyyyyZyyZyZZyyZyyZ
jMMNMMMMBWBXxI(z??1. ?7! .dWkHMMWZdMWWWWyyZyy} MMM:..?`..JNyZyZZyZZyyZyyZyZyyZyy
#NWgNmaggme&zX(ZjNMMNa.+MNMWWUNWXiHyyyyZyZyZyr WMMNg.. TMMWZyyZyyZyyZyZyyZyZyyZy
WMMMMMMH@HHHHHbXMMMMMMMMMHHWyq#WRWyZyZyyZyyZyyo.?WMMM@ JkyyZyZyyZyyZyyZyZyyZyZyZ
MMMMMMMHH@H@H@HkH@HM""UQkyyZyyZd#yZyZyZyyY!_777= ... `.MHZyyZyyZyZyZyZyyZyZyyZyy
MMMMMMM@H@H@HH@HHM9>   `.THyZyXMyZyyyZyZy (MMNNggMMk....(yZyyZyyZyyyZyyZyyZyZyZy
MMMMMMMH@H@H@H@@M3?<`     .WyZyyZyyZyyZyy ?""YMMMMMMMMM`.RyZyZyZyZyZyyZyZyyZyyZy
MMMMMMMMH@HH@HHHC111+..     HyyZyZyZZyyZyX}.dMMMMMM ....VWY4XyZyyZyyZyyZyZyyZyyZ
TT7C17TTMH@H@@HM?1S????+-   (HZyyyZyyZyyZy}.MMNJMMM},M\(`.j<^?WyZyZyZyZyyZyZyZyy
J++&+;;;;WH@HHH@Axd??????!   WyZyXyUHUUHT9R .TWMMMM`(M!_`_`.<1<4yZyyyZyyZyyZyyZy
MMMMMN+;;;dH@HH@ROdI????:    _WQ91>>>?uQZkz.(MMMM9`.M@``````.JXeTkyZyyZyyZyyZyZy
MMMMMMNc;;;M@@HHHyzI??zv1-.   .S>?>?>dkXWHW$ ~`  ,MMM:``````(HyyHyZyZyZyZyZyyZyZ
uuXWMMMN<;;?HH@@HMs0????.    ~`,p??>?>+ugWyr MMM# (V"`` ` `.KyZyyZyyZyyZyyZyZyyy
uuuuuuXMR;;;dH@H@@HR????<.    .fjWHHMWwyyZy% MMM%.>`````` .HWWWWkQQmQQQQQkyXXXXX
uuuuuuuuWx;;?MHH@HHK?????1. .J".9U99UTTTTOO{.MMM (!`` .(Iz==zz=zO+--((++???<???7
uuuuuuuuuI;;;dH@H@HHHHBYYBY9>./ .O==lzvv7!` .MMF v-.vOOOOwOttOrOzzzzwzzzzzzzz=zz
uuuuuuuuuX;;;dMH@H@HNMMMMN??<````(7!``````` jJ-,.BU0XwwAs&&aaa&&&&zzz===========
uuuuuuuuuuI;;(MMMH@MMMMM9=h><````` !``` ``  MMM%.O=?=?=?=?==?==??=?====zzOOOOTTT
uuuuuuuuuuI;;;MMMMHMMHH?=?dR< ``````````` .-....JI==?=?=?=?==?==?=??=??=?=??=??=
uuuuuuuuuuu<;;dMMM#yyyH=?=d#R<  `` ` ``.JMMMNNNNNggggggggaa&zzzzz===?==?=?==?==?
uuuuuuuuuuuc;;jMMMMyyZH=?=d#MK<.`` ..gMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNNNNNNgg

*K.O.E. LED Strip System V4
* Author: Fumiaki Mizuno 17 あっきー
* Date: 2017/12/08
* このプログラムは冬コン2017に向けてカスタマイズされたものです。
* 汚く、保守性を考えていないコードを書いて申し訳ありません。
*
*/



 /////////////////インクルードファイル/////////////////////
 #include <Adafruit_NeoPixel.h>
 
 /////////////////インクルードファイル/////////////////////
 #ifdef __AVR__
   #include <avr/power.h>
 #endif
 
 /////////////////定義/////////////////////
 #define PIN           10
 #define DEBUG_LED     2
 #define PSW1          11
 #define PSW2          12
 #define NUMPIXELS     300
 #define COLUMN1       75
 #define COLUMN2       100
 #define COLUMN3       125
 
 /////////////////インタンス生成/////////////////////
 Adafruit_NeoPixel strip = Adafruit_NeoPixel(NUMPIXELS, PIN, NEO_GRB + NEO_KHZ800);
 
 /////////////////グローバル変数宣言/////////////////////
 char mode='0';
 
 boolean spacemode = false, pressmode = false;
 
 boolean mode_flg = false;
 
 /////////////////プロトタイプ宣言/////////////////////
 void specialCode( void );
 void colorWipe(uint32_t c,uint16_t wait);
 void rainbow(uint8_t wait);
 void rainbowCycle(uint16_t wait);
 void theaterChase(uint32_t c, uint16_t wait);
 void theaterChaseRainbow(uint16_t wait);
 uint32_t Wheel(byte WheelPos);
 
 void fadeChange(uint8_t R, uint8_t G, uint8_t B, uint16_t wait);
 void fadeAllOff(uint16_t wait);
 void fadeAllOn(uint8_t r, uint8_t g, uint8_t b, uint16_t wait);
 void patAllOn(uint8_t r, uint8_t g, uint8_t b);
 void patAllOff( void );
 void patOnLine(uint8_t r, uint8_t g, uint8_t b, uint8_t column_num);
 void patOffLine(uint8_t line_num);
 void sendResponce( void );
 
 void ASUPANIMODE( void );
 void BISEIBUTSUMODE( void );
 void YUSHAMODE ( void );
 void GROOOOOOTMODE ( void );
 void LOLLIPOPMODE ( void );
 void LEAKMODE ( void );
 void LEMONMODE ( void );
 
 void specialCode( void ){
  
   #if defined (__AVR_ATtiny85__)
     if (F_CPU == 16000000) clock_prescale_set(clock_div_1);
   #endif
  
 }
 
 void colorWipe(uint32_t c,uint16_t wait) {
   for(uint16_t i=0; i<strip.numPixels(); i++) {
     strip.setPixelColor(i, c);
     strip.show();
     delay(wait);
   }
 }
 
 void rainbow(uint8_t wait) {
   uint16_t i, j;
 
   for(j=0; j<256; j++) {
     for(i=0; i<strip.numPixels(); i++) {
       strip.setPixelColor(i, Wheel((i+j) & 255));
     }
     strip.show();
     delay(wait);
   }
 }
 
 void rainbowCycle(uint16_t wait) {
   uint16_t i, j;
 
   for(j=0; j<256*5; j++) { // 5 cycles of all colors on wheel
     for(i=0; i< strip.numPixels(); i++) {
       strip.setPixelColor(i, Wheel(((i * 256 / strip.numPixels()) + j) & 255));
     }
     strip.show();
     delay(wait);
   }
 }
 
 //Theatre-style crawling lights.
 void theaterChase(uint32_t c, uint16_t wait) {
   for (int j=0; j<10; j++) {  //do 10 cycles of chasing
     for (int q=0; q < 3; q++) {
       for (uint16_t i=0; i < strip.numPixels(); i=i+3) {
         strip.setPixelColor(i+q, c);    //turn every third pixel on
       }
       strip.show();
 
       delay(wait);
 
       for (uint16_t i=0; i < strip.numPixels(); i=i+3) {
         strip.setPixelColor(i+q, 0);        //turn every third pixel off
       }
     }
   }
 }
 
 //Theatre-style crawling lights with rainbow effect
 void theaterChaseRainbow(uint16_t wait) {
   for (int j=0; j < 256; j++) {     // cycle all 256 colors in the wheel
     for (int q=0; q < 3; q++) {
       for (uint16_t i=0; i < strip.numPixels(); i=i+3) {
         strip.setPixelColor(i+q, Wheel( (i+j) % 255));    //turn every third pixel on
       }
       strip.show();
 
       delay(wait);
 
       for (uint16_t i=0; i < strip.numPixels(); i=i+3) {
         strip.setPixelColor(i+q, 0);        //turn every third pixel off
       }
     }
   }
 }
 
 // Input a value 0 to 255 to get a color value.
 // The colours are a transition r - g - b - back to r.
 uint32_t Wheel(byte WheelPos) {
   WheelPos = 255 - WheelPos;
   if(WheelPos < 85) {
     return strip.Color(255 - WheelPos * 3, 0, WheelPos * 3);
   }
   if(WheelPos < 170) {
     WheelPos -= 85;
     return strip.Color(0, WheelPos * 3, 255 - WheelPos * 3);
   }
   WheelPos -= 170;
   return strip.Color(WheelPos * 3, 255 - WheelPos * 3, 0);
 }
 
 void fadeChange(uint8_t R, uint8_t G, uint8_t B, uint16_t wait){
   boolean R_flg = true, G_flg = true, B_flg = true;
   strip.setBrightness(255);
 
   while( (R_flg==true) || (G_flg==true) || (B_flg==true) ){//全ての値が目標値に到達していなかったら
      uint32_t color = strip.getPixelColor(0);
      
      uint8_t now_R = ( color >> 16 );
      uint8_t now_G = ( color >> 8 );
      uint8_t now_B = ( color );
    
      int16_t diff_R;
      int16_t diff_G;
      int16_t diff_B;
     for(int16_t i = 0; i < strip.numPixels(); i++ ){//するまでやる

       diff_R = R - now_R;
       diff_G = G - now_G;
       diff_B = B - now_B;
       
       /*Serial.print(diff_R,HEX);
       Serial.print("  = ");
       Serial.print(R,HEX);
       Serial.print("  - ");
       Serial.println(now_R,HEX);
      
       Serial.print(diff_G,HEX);
       Serial.print("  = ");
       Serial.print(G,HEX);
       Serial.print("  - ");
       Serial.println(now_G,HEX);
 
       Serial.print(diff_B,HEX);
       Serial.print("  = ");
       Serial.print(B,HEX);
       Serial.print("  - ");
       Serial.println(now_B,HEX);
       Serial.println();*/
       
       if( diff_R > 0 ){//目標値のほうがが大きいので明るさを増やす
         now_R++;
       }
       else if( diff_R < 0 ){//目標値の方が小さいので明るさを減らす
         now_R--;
       }
       else if( diff_R == 0 ){//目標値と現在の明るさが一致しているのでOK
         R_flg = false;

       }
   
       if( diff_G > 0 ){
         now_G++;
       }
       else if( diff_G < 0 ){
         now_G--;
       }
       else if( diff_G == 0 ){
         G_flg = false;
       }
   
       if( diff_B > 0 ){
         now_B++;
       }
       else if( diff_B < 0 ){
         now_B--;
       }
       else if( diff_B == 0 ){
         B_flg = false;
       }
       strip.setPixelColor(i, now_R, now_G, now_B);
     }
     strip.show();
     delay(wait);
   }
 }
 
 void fadeAllOff(uint16_t wait){
   for(signed int k=255; k>=0; k=k-10){
     strip.setBrightness(k);
     strip.show();
     delay(wait);
   }
   for(signed int i=0; i<strip.numPixels(); i++){
     strip.setPixelColor(i, 0, 0, 0);
   }
   strip.setBrightness(255);
   strip.show();
 }
 
 void fadeAllOn(uint8_t r, uint8_t g, uint8_t b, uint16_t wait){
   for(uint16_t j=0; j<strip.numPixels(); j++){
     strip.setPixelColor(j, r, g, b);
   }
   for(uint16_t k=0; k<=255; k=k+5){
     strip.setBrightness(k);
     strip.show();
     delay(wait);
   }
 }
 
 void patAllOn(uint8_t r, uint8_t g, uint8_t b){
   for(uint16_t a=0; a<strip.numPixels(); a++){
     strip.setPixelColor(a, r, g, b);
   }
   Serial.println("patAllOn");
   strip.setBrightness(255);
   strip.show();
 }
 
 void patAllOff( void ){
   for(signed int a=0; a<strip.numPixels(); a++){
     strip.setPixelColor(a, 0, 0, 0);
   }
   strip.show();
 }
 
 void patOnLine(uint8_t r, uint8_t g, uint8_t b, uint8_t column_num){//列単位で点灯します。
   int16_t i = 0;
   if(column_num==1){
     for(i=0; i<COLUMN1; i++){
       strip.setPixelColor(i, r, g, b);
     }
   }
   else if(column_num==2){
     for(i=COLUMN1; i<COLUMN1+COLUMN2; i++){
       strip.setPixelColor(i, r, g, b);
     }
   }
   else if(column_num==3){
     for(i=COLUMN1+COLUMN2; i<COLUMN1+COLUMN2+COLUMN3; i++){
       strip.setPixelColor(i, r, g, b);
      }
   }
   strip.show();
 }
 
 void patOffLine(uint8_t line_num){//列単位で消灯します
   int16_t i = 0;
   if(line_num==1){
     for(i=0; i<COLUMN1; i++){
       strip.setPixelColor(i, 0, 0, 0);
     }
   }
   else if(line_num==2){
     for(i=COLUMN1; i<COLUMN1+COLUMN2; i++){
       strip.setPixelColor(i, 0, 0, 0);
     }
   }
   else if(line_num==3){
     for(i=COLUMN1+COLUMN2; i<COLUMN1+COLUMN2+COLUMN3; i++){
       strip.setPixelColor(i, 0, 0, 0);
      }
   }
   strip.show();
 }
 
 void fadeChangeBrightness(uint8_t now_brightness, uint8_t brightness, uint16_t wait){
   if( (brightness - now_brightness) > 0 ){
     for(int i=now_brightness+1; i <= brightness; i++){
       strip.setBrightness(i);
       strip.show();
       delay(wait);
     }
   }
   else if( (brightness - now_brightness) < 0 ){
     for(int i=now_brightness; i >= brightness; i--){
       strip.setBrightness(i);
       strip.show();
       delay(wait);
     }
   }
 }
 
 void sendResponce( void ){
   Serial.print("OK");
 }

 uint8_t SerialWaitRead( void ){
   while(Serial.available()==0);
   Serial.println("Waiting command");
   uint8_t commingInByte = Serial.read();
   Serial_flush();
   return commingInByte;
 }

 void Serial_flush( void ){
   while( Serial.available()>0 ){
     uint8_t trashByte = Serial.read();
   }
   Serial.println("SerialFlush");
 }
 
 void ASUPANIMODE( void ){
   Serial.println("あすかが突然パニックモードに入りました。");
   Serial.println("入り方：（よっぴーパーカス）どんつ1どんつ2どどん3どどん4 5パラGO");
   Serial.println("0x20, 1左, 2右, 3全点灯, 4流れ星");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
 
   #define ONLEDNUM  15
 
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
     }
     else str = 0;//なにも来てなかったら何も動かさない
     if(str == 0x20){
       if( num >= 20 ) num = 0;//2回目以降
 
       if      (num==0||num==4||num==8)   patOnLine(0,0,255,1);
       else if (num==1||num==5||num==9)   patOnLine(0,0,255,2);
       else if (num==2||num==6||num==10)  patOnLine(0,0,255,3);
       else if (num==3||num==7||num==11)  patAllOff();
       else if (num<=12 && num>=15){
         patAllOn(255,255,255);
         delay(200);
         patAllOff();
       }
       else if(num==16) patOnLine(255,0,0,3);
       else if(num==17) patOnLine(0,255,0,2);
       else if(num==18) patOnLine(0,0,255,1);
       else if(num==19) patAllOn(255,255,255);
       num++;
       sendResponce();
     }
     
     else if(str == '1'){
       for(i=0; i<ONLEDNUM; i++){
         strip.setPixelColor(i, 0, 0, 255);//1列目左端ONLEDNUM個点灯
       }
       for(i=COLUMN1+COLUMN2-ONLEDNUM; i<COLUMN1+COLUMN2; i++){//2列目左端ONLEDMUN個点灯
         strip.setPixelColor(i, 0, 0, 255);
       }
       for(i=COLUMN1+COLUMN2; i<COLUMN1+COLUMN2+ONLEDNUM; i++){//3列目左ONLEDNUM個点灯
         strip.setPixelColor(i, 0, 0, 0);
       }
       strip.show();
       delay(500);
       patAllOff();
       sendResponce();
     }
 
     else if(str == '2'){
       for(i=COLUMN1-ONLEDNUM; i<COLUMN1; i++){
         strip.setPixelColor(i, 0, 0, 255);//1列目Right端15個点灯
       }
       for(i=COLUMN1; i<COLUMN1+ONLEDNUM; i++){
         strip.setPixelColor(i, 0, 0, 255);
       }
       for(i=COLUMN1+COLUMN2+COLUMN3-ONLEDNUM; i<COLUMN1+COLUMN2+COLUMN3; i++){
         strip.setPixelColor(i, 0, 0, 255);
       }
       strip.show();
       delay(500);
       patAllOff();
       sendResponce();
     }
 
     else if( str == '3' ){
       patAllOn(255,255,255);
       delay(400);
       fadeAllOff(0);
       sendResponce();
     }
 
     else if(str == '4'){//もしかしたらcolorWipeでも良いかもしれない。様子を見て。
       boolean quit_flg = true;
       Serial_flush();
       while(quit_flg){
         if(Serial.available()>0){
           quit_flg = false;//while条件終わり
           i = strip.numPixels();//For分条件終わり
         }
        colorWipe(strip.Color(255,255,0),10);
        if(Serial.available()>0){//str=3のループを抜けて今来たバイトを先頭に戻って読ませる。
          quit_flg = false;//while条件終わり
          i = strip.numPixels();//For分条件終わり
        }
        colorWipe(strip.Color(0,255,255),10);
        if(Serial.available()>0){//str=3のループを抜けて今来たバイトを先頭に戻って読ませる。
          quit_flg = false;//while条件終わり
          i = strip.numPixels();//For分条件終わり
        }
        colorWipe(strip.Color(255,0,255),10);
        if(Serial.available()>0){//str=3のループを抜けて今来たバイトを先頭に戻って読ませる。
          quit_flg = false;//while条件終わり
          i = strip.numPixels();//For分条件終わり
        }
        sendResponce();
       }
     }
     else if(str == '5'){
       fadeAllOff(5);
       sendResponce();
       Serial.println("End of ASUPANIMODE. Please Quit");
     }
     else if( str == 'q' ){
       mode_flg = false;
       sendResponce();
       Serial.println("Quit ASUPANIMODE");
       Serial_flush();
     }
   }
 }
 
 void BISEIBUTSUMODE( void ){
   Serial.println("微生物モードに入りました。");
   Serial.println("入り方：なーつがあーつがのーのーのー" );
   Serial.println("");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
   #define ONLEDNUM 20
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
       Serial_flush();
     }
     else str = 0;//なにも来てなかったら何も動かさない
 
     switch(str){
       case 0x20:{
         patAllOff();
         num = 0;
         sendResponce();
         break;
       }
       case '0':{//なーつがあーつがのーのーのー
         patAllOn(255, 255, 255);
         delay(200);
         fadeAllOff(5);
         sendResponce();
         break;
       }
 
       case '1':{
        if(num==0){
          patOffLine(1);
          patOffLine(2);
          patOnLine(255,0,0,3);
          sendResponce();
        }
        else if (num==1){
          patOffLine(1);
          patOnLine(255,0,0,2);
          patOffLine(3);
          sendResponce();
        }
        else if (num==2){
          patOnLine(255,0,0,1);
          patOffLine(2);
          patOffLine(3);
          sendResponce();
        }
        else if (num==3){
          patAllOff();
          sendResponce();
        }
        num++;
        if( num > 3 ){
          num = 0;
        }
         break;
       }
 
       case '2':{//青左右から迫ってくる
         boolean quit_flg  = true;
         uint16_t times = 0;
         Serial_flush();
         while(quit_flg){
           for(times=0; times<COLUMN1/2; times++){
             for(i=0; i<times; i++){
               strip.setPixelColor(i, 0, 0, 255);
             }
             for(i=COLUMN1; i>COLUMN1/2; i--){
               strip.setPixelColor(i, 0, 0, 255);
             }
             strip.show();
             delay(40);
             if(Serial.available()>0){
              quit_flg = false;
              Serial.println("false");
             }
           }
           sendResponce();
           for(times=0; times<COLUMN2/2; times++){
             for(i=0; i<times; i++){
               strip.setPixelColor(i, 0, 0, 255);
             }
             for(i=COLUMN2; i>COLUMN2/2; i--){
               strip.setPixelColor(i, 0, 0, 255);
             }
             strip.show();
             delay(40);
             if(Serial.available()>0){
              quit_flg = false;
              Serial.println("false");
             }
           }
           sendResponce();
           for(times=0; times<COLUMN3/2; times++){
             for(i=0; i<times; i++){
               strip.setPixelColor(i, 0, 0, 255);
             }
             for(i=COLUMN3; i>COLUMN3/2; i--){
               strip.setPixelColor(i, 0, 0, 255);
             }
             strip.show();
             delay(40);
             if(Serial.available()>0){
              quit_flg = false;
              Serial.println("false");
             }
           }
           sendResponce();
           if(Serial.available()>0){
            quit_flg = false;
            Serial.println("false");
           }
         }
         sendResponce();
         break;
       }
 
       case '3':{
         for(i=0; i<ONLEDNUM; i++){
           strip.setPixelColor(i, 255, 0, 0);//1列目左端ONLEDNUM個点灯
         }
         for(i=COLUMN1+COLUMN2-ONLEDNUM; i<COLUMN1+COLUMN2; i++){//2列目左端ONLEDMUN個点灯
           strip.setPixelColor(i, 255, 0, 0);
         }
         for(i=COLUMN1+COLUMN2; i<COLUMN1+COLUMN2+ONLEDNUM; i++){//3列目左ONLEDNUM個点灯
           strip.setPixelColor(i, 255, 0, 0);
         }
         strip.show();
         delay(500);
         patAllOff();
         sendResponce();
         break;
       }
 
       case '4':{
         for(i=COLUMN1-ONLEDNUM; i<COLUMN1; i++){
           strip.setPixelColor(i, 0, 0, 255);//1列目Right端15個点灯
         }
         for(i=COLUMN1; i<COLUMN1+ONLEDNUM; i++){
           strip.setPixelColor(i, 0, 0, 255);
         }
         for(i=COLUMN1+COLUMN2+COLUMN3-ONLEDNUM; i<COLUMN1+COLUMN2+COLUMN3; i++){
           strip.setPixelColor(i, 0, 0, 255);
         }
         strip.show();
         delay(500);
         patAllOff();
         sendResponce();
         break;
       }
 
       case '5':{
        if(num==0){
          patOnLine(255,0,0,1);
        }
        else if (num==1){
          patOffLine(1);
          patOnLine(255,0,0,2);
        }
        else if (num==2){
          patOffLine(1);
          patOffLine(2);
          patOnLine(255,0,0,3);
        }
        else if (num==3){
          patAllOn(255,255,255);
        }
        num++;
        if( num > 3 ){
          num = 0;
        }
        sendResponce();
         break;
       }
 
       case '6':{
         colorWipe(strip.Color(255,0,0), 10);
         sendResponce();
         break;
       }
 
       case '7':{
         fadeAllOff(5);
         sendResponce();
         Serial.println("End of BISEIBUTSU. Please quit");
         break;
       }
 
       case 'q':{
         mode_flg = false;
         sendResponce();
         Serial_flush();
         Serial.println("Quit BISEIBUTSUMODE");
       }
     }
   }
 }
 
 void YUSHAMODE( void ){
   Serial.println("勇者御一行モードに入りました。");
   Serial.println("入り方：LALALA...で0に入る" );
   Serial.println("");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
 
 
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
       Serial_flush();
       Serial.println("とまってるよー");
     }
     else str = 0;//なにも来てなかったら何も動かさない
 
     switch(str){
       case '0':{
         patAllOn(0,255,0);
         sendResponce();
         break;
       }
 
       case '1':{
         fadeAllOff(10);
         sendResponce();
         break;
       }
 
       case '2':{
         boolean quit_flg  = true;
         uint16_t times = 0;
         while(quit_flg){
           for(times=0; times<COLUMN1/2; times++){
             for(i=0; i<times; i++){
               strip.setPixelColor(i, 255, 0, 0);
               if(Serial.available()>0){
                 quit_flg = false;
               }
             }
             for(i=COLUMN1; i>COLUMN1/2; i--){
               strip.setPixelColor(i, 255, 0, 0);
             }
             strip.show();
             delay(40);
             if(Serial.available()>0){
               quit_flg = false;
             }
           }
 
           for(times=0; times<COLUMN2/2; times++){
             for(i=0; i<times; i++){
               strip.setPixelColor(i, 255, 0, 0);
             }
             for(i=COLUMN2; i>COLUMN2/2; i--){
               strip.setPixelColor(i, 255, 0, 0);
             }
             strip.show();
             delay(40);
             if(Serial.available()>0){
               quit_flg = false;
             }
           }
 
           for(times=0; times<COLUMN3/2; times++){
             for(i=0; i<times; i++){
               strip.setPixelColor(i, 255, 0, 0);
             }
             for(i=COLUMN3; i>COLUMN3/2; i--){
               strip.setPixelColor(i, 255, 0, 0);
             }
             strip.show();
             delay(40);
             if(Serial.available()>0){
               quit_flg = false;
             }
           }
         }
         sendResponce();
         break;
       }
 
       case '3':{
         fadeAllOff(10);
         sendResponce();
         break;
       }
 
       case '4':{
         patAllOn(254,254,0);
         sendResponce();
         Serial_flush();
         break;
       }
 
       case '5':{
         patAllOn(0,25,0);
         sendResponce();
         Serial_flush();
         break;
       }
 
       case '6':{//一人一人挨拶
         byte num=1;
         boolean quit_flg  = true;
         Serial_flush();
         while(quit_flg){
           if(SerialWaitRead()=='6'){
            if( num == 0 ) fadeAllOff(1);
            else if( num == 1 ) colorWipe(strip.Color(  157,  204,  254 ), 10);//あゆみ
            else if( num == 2 ) colorWipe(strip.Color(    0,  255,    0 ), 10);//ぐっちー
            else if( num == 3 ) colorWipe(strip.Color(  135,    0,  204 ), 10);//いずみ
            else if( num == 4 ) colorWipe(strip.Color(  255,   55,    0 ), 10);//まーしー
            else if( num == 5 ) colorWipe(strip.Color(  255,    0,  255 ), 10);//かなみ
            else if( num == 6 ) colorWipe(strip.Color(    0,    0,  255 ), 10);//つばさ
            else if( num == 7 ) colorWipe(strip.Color(  255,    0,    0 ), 10);//ねぐせ
            else if( num == 8 ){
              colorWipe(strip.Color(0, 0, 0), 3);//消灯
              quit_flg = false;
            }
            num++;
            sendResponce();
            Serial_flush();
           }
         }
         sendResponce();
         break;
       }
 
       case '7':{//最後の礼をするところ ららららーーらーらーらーー
       //fadeAllOn(254, 254, 254, 10);
        for(uint16_t j=0; j<strip.numPixels(); j++){
          strip.setPixelColor(j, 254, 254, 254);
        }
        strip.show();
       sendResponce();
       Serial.println("8 to fade Trun Off. ");
       break;
       }
 
       case '8':{
       fadeAllOff(5);
       sendResponce();
       Serial.println("Press 'q' to Quit YUSYAMODE");
       break;
       }
 
       case 'q':{
       mode_flg = false;
       sendResponce();
       Serial.println("Quit YUSYAMODE");
       Serial_flush();
       break;
       }
 
       case 0x20:{
         patAllOff();
         //num = 0;
         sendResponce();
         break;
       }
     }
   }
 }
 
 void GROOOOOOTMODE( void ){
   Serial.println("Groooootモードにはいりました。");
   Serial.println("入り方：" );
   Serial.println("");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
 
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
     }
     else str = 0;//なにも来てなかったら何も動かさない
 
     switch(str){
       case '0':{
         fadeAllOn(5,0,50,20);//ひさブルー
         strip.setBrightness(128);
         strip.show();
         sendResponce();
         break;
       }
 
       case '1':{
         strip.setBrightness(255);
         colorWipe(strip.Color(255,255,255), 10);
         sendResponce();
         break;
       }
 
       case '2':{
         if(num==0) patOnLine(255, 55, 0, 1);
         else if(num==1) patOnLine(255, 55, 0, 2);
         else if(num==2) patOnLine(255, 55, 0, 3);
         else if(num==3) patAllOn(255, 255, 255);
         num++;
         sendResponce();
         break;
       }
 
       case '3':{
         fadeAllOff(1);
         Serial.println("End of program. Please Quit GROOOOOOTMODE");
         sendResponce();
         break;
       }
 
       case 0x20:{
         fadeAllOff(10);
         sendResponce();
         break;
       }
 
       case 'q':
       mode_flg = false;
       sendResponce();
       Serial_flush();
       Serial.println("Quit GROOOOOOTMODE");
       break;
     }
   }
 }
 
 void LOLLIPOPMODE( void ){
   Serial.println("Groooootモードにはいりました。");
   Serial.println("入り方：" );
   Serial.println("");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
 
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
     }
     else str = 0;//なにも来てなかったら何も動かさない
     switch(str){
       case '0':{
         fadeChange(255, 0, 255, 20);
         sendResponce();
         break;
       }
       case '1':{
         fadeChange(254, 254, 254, 20);
         sendResponce();
         break;
       }
       case '2':{
         fadeAllOff(5);
         sendResponce();
         break;
       }
       case '3':{
         patAllOn(255,255,255);
         break;
       }
       case 0x20:{
         patAllOff();
         sendResponce();
         break;
       }
       case 'q':{
         mode_flg = false;
         sendResponce();
         Serial_flush();
         Serial.println("Quit LOLLIPOPMODE");
       }
     }
   }
 }
 
 void LEAKMODE ( void ){
   Serial.println("LEAKモードにはいりました。");
   Serial.println("入り方：" );
   Serial.println("");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
 
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
     }
     else str = 0;//なにも来てなかったら何も動かさない
     switch(str){
       case '0':{
         strip.setBrightness(255);
         patAllOn(0, 0, 255);
         break;
       }
       case '1':{
         fadeChangeBrightness(255, 50, 5);
         break;
       }
       case '2':{
         fadeChangeBrightness(50, 255, 5);
         break;
       }
       case '3':{
         strip.setBrightness(255);
         patOnLine(255, 0, 0, 1);
         patOffLine(2);
         patOffLine(3);
         break;
       }
       case '4':{
         strip.setBrightness(255);
         patOffLine(1);
         patOnLine(255, 0, 0, 2);
         patOnLine(255, 0, 0, 3);
         break;
       }
 
       case '5':{
         fadeAllOff(5);
         break;
       }
       case 0x20:{
         strip.setBrightness(255);
         patAllOff();
         break;
       }
       case 'q':{
         mode_flg = false;
         sendResponce();
         Serial_flush();
         Serial.println("Quit LEAKMODE");
       }
     }
   }
 }
 
 void LEMONMODE( void ){
   Serial.println("LEAKモードにはいりました。");
   Serial.println("入り方：" );
   Serial.println("");
   mode_flg = true;
   uint8_t num = 0;
   int32_t i = 0;
   char str = 0;
   #define ONLEDNUM 10
   while(mode_flg){
     if(Serial.available()>0){
       str = Serial.read();
     }
     else str = 0;//なにも来てなかったら何も動かさない
     switch(str){
       case '0':{
         for(uint16_t j=COLUMN2; j<COLUMN3; j++){
           strip.setPixelColor(j, 255, 255, 0);
         }
         for(uint16_t k=0; k<=255; k=k+10){
           strip.setBrightness(k);
           strip.show();
           delay(20);
         }
         break;
       }
       case '1':{
         patOffLine(3);
         patOnLine(255,255,0,1);
         break;
       }
       case '2':{
         colorWipe(strip.Color(0,0,255), 10);
         break;
       }
       case '3':{
         fadeChange(254, 254, 0, 5);
         break;
       }
       case '4':{//I`ll going back
         for(i=COLUMN1-ONLEDNUM; i<COLUMN1; i++){
           strip.setPixelColor(i, 0, 0, 255);//1列目Right端
         }
         for(i=COLUMN1; i<COLUMN1+ONLEDNUM; i++){
           strip.setPixelColor(i, 0, 0, 255);
         }
         for(i=COLUMN1+COLUMN2+COLUMN3-ONLEDNUM; i<COLUMN1+COLUMN2+COLUMN3; i++){
           strip.setPixelColor(i, 0, 0, 255);
         }
         strip.show();
         break;
       }
       case '5':{
         boolean quit_flg = true;
         while(quit_flg){
           if(Serial.available()>0){
             quit_flg = false;//while条件終わり
           }
           for(int i=0; i>=255; i++){
             patAllOn(255, i, 0);
             delay(10);
             if(Serial.available()>0){
               quit_flg = false;//while条件終わり
               i=256;
             }
           }
           for(int i=255; i<=0; i--){
             patAllOn(255, i, 0);
             delay(10);
             if(Serial.available()>0){
               quit_flg = false;//while条件終わり
               i = -1;
             }
           }
           if(Serial.available()>0){
             quit_flg = false;//while条件終わり
           }
         }
         break;
       }
       case '6':{
         colorWipe(strip.Color(0,0,255), 5);
         break;
       }
       case '7':{
         fadeChange(254, 254, 254, 5);
         break;
       }
 
       case '8':{
         fadeAllOff(3);
         break;
       }
 
       case 0x20:{
         strip.setBrightness(255);
         patAllOff();
         break;
       }
       case 'q':{
         mode_flg = false;
         sendResponce();
         Serial_flush();
         Serial.println("Quit LEMONMODE");
       }
     }
   }
 }
 
 void setup() {
   pinMode(PSW1, INPUT_PULLUP);
   pinMode(PSW2, INPUT_PULLUP);
   pinMode(DEBUG_LED, OUTPUT);
   Serial.begin(115200);
   specialCode();
   strip.begin();
   
   strip.show(); // Initialize all pixels to 'off'
   patAllOff();
   Serial.println("KOE_LED System TestRev.4 (Alpha) Started!");
   
   mode = '0';
 }
 
 void loop() {
 
   switch (mode){
     case '0':{//スタート分岐
       Serial.println("fadeAllOff.");
       fadeAllOff(10);
       strip.show();
       Serial.println("fadeAllOff. Waiting mode commands.");
       Serial.println("  '0':  Turn Off.....すべてOFF、コマンド待ちモード");
       Serial.println("  '1':  All test.....動作確認モード");
       Serial.println("  '2':  Press mode...押している間だけ光るモードに切り替え");
       Serial.println("  '3':  あすかが突然パニックモード");
       Serial.println("  '4':  微生物モード");
       Serial.println("  '5':  勇者御一行モード");
       Serial.println("  '6':  LemonSquashモード");
       Serial.println("  '7':  GROOOOOOTモード");
       Serial.println("  '8':  ロリポップモード");
       Serial.println("  '9':  LEAKモード");
       Serial.println("Space: Space mode enable...ふわっと光らせるモードに切り替え");
       Serial.flush();
       mode = SerialWaitRead();
       Serial_flush();
      break;
     }
      
     case '1':{//All test動作確認モード
       Serial.println("Do you want to Really start All test?");
       Serial.println("y or n");
       while( Serial.available() <= 0 );
       char rcv = Serial.read();
       if( rcv == 'y' ){
         colorWipe(strip.Color(255, 0, 0), 20); // Red
         colorWipe(strip.Color(0, 255, 0), 20); // Green
         colorWipe(strip.Color(0, 0, 255), 20); // Blue
         colorWipe(strip.Color(255, 255, 255), 20); // White RGBW
         // Send a theater pixel chase in...
         theaterChase(strip.Color(255, 255, 255), 20); // White
         theaterChase(strip.Color(255, 0, 0), 20); // Red
         theaterChase(strip.Color(0, 255, 0), 20); // green
         theaterChase(strip.Color(0, 0, 255), 20); // Blue
         rainbow(10);
         rainbowCycle(10);
         theaterChaseRainbow(20);
         mode = '0';
         Serial.println("End mode = 0");
       }
       else if( rcv == 'n'){
         Serial.println("Exit mode=0");
         mode = '0';
       }
       else{
         Serial.println("Send y or n");
       }
       break;
     }
       
     case '2':{//patOnテストモード
       Serial.println("Press mode Selected.");
       Serial.println("Send colors: ");
       Serial.println("        red: r");
       Serial.println("       blue: b");
       Serial.println("      green: g");
       Serial.println("     orange: o");
       Serial.println("     yellow: y");
       Serial.println("       pink: p");
       Serial.println("      white: w");
       Serial.println("        off: Space bar");
       Serial.println();
       Serial.println("       quit: q");
 
       pressmode = true;
       char rcv = 0x20;
       while( pressmode ){
         rcv = SerialWaitRead();
         Serial_flush();
         if( rcv == 'q' ){
           pressmode = false;
           mode = '0';//Off mode
           Serial_flush();
           Serial.println("Quit, mode = 0");
         }
         else if( rcv == 'r' ){
           patAllOn(255,0,0);
           Serial_flush();
           // Red
         }
         else if( rcv == 'g' ){
           patAllOn(0,255,0);
           Serial_flush();
           // Green
         }
         else if( rcv == 'b' ){
           patAllOn(0,0,255);
           Serial_flush();
           // Blue
         }
         else if( rcv == 'o' ){
           patAllOn(255,165,0);
           Serial_flush();
           // Orange
         }
         else if( rcv == 'y' ){
           patAllOn(255,255,0);
           Serial_flush();
           // Yellow
         }
         else if( rcv == 'w' ){
           patAllOn(255,255,255);
           Serial_flush();
           // White
         }
         else if( rcv == 'p' ){
           patAllOn(255,0,255);
           Serial_flush();
         }
         else if( rcv == 0x20 ){
           patAllOff();
           Serial_flush();
         }
         else if( rcv=='a'){
           patOnLine(255,255,255,3);
           Serial_flush();
         }
       }
       Serial.println("Exit Press mode");
       mode = '0';
       break;
     }
       
     case '3':{//アスパニモード
       char rcv=0;
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("あすかが突然パニック");
       Serial.println("REALLY? y or n");
       rcv = SerialWaitRead();
       Serial_flush();
        if(rcv =='y'){
           ASUPANIMODE();
           Serial.println("End ASUPANIMODE mode = '0';");
           mode = '0';
        }
        else{
          mode = '0';
          Serial.println("Quit ASUPANIMODE mode = 0;");
          Serial.println(mode, HEX);
        }   
       break;
     }
 
     case '4':{//微生物モード
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("微生物モード");
       Serial.println("REALLY? y or n");
       char rcv = SerialWaitRead();
       Serial_flush();
       if(rcv =='y'){
         BISEIBUTSUMODE();
         Serial.println("Quit BISEIBUTSUMODE mode = '0';");
         mode = '0';
       }
       else{
         mode = '0';
         Serial.println("Quit BISEIBUTSUMODE mode = 0;");
       }
       break;
     }
 
     case '5':{//勇者御一行モード
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("勇者御一行");
       Serial.println("REALLY? y or n");
       char rcv = SerialWaitRead();
       Serial_flush();
       if(rcv =='y'){
         sendResponce();
         YUSHAMODE();
         Serial.println("Quit YUSHAMODE mode = '0';");
         mode = '0';
       }
       else{
         mode = '0';
         Serial.println("Quit YUSHAMODE mode = 0;");
       }
       break;
     }
 
     case '6':{//レモンスカッシュモード
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("LemonSquashモード");
       Serial.println("REALLY? y or n");
       char rcv = SerialWaitRead();
       Serial_flush();
       if(rcv =='y'){
         sendResponce();
         LEMONMODE();
         Serial.println("Quit YUSHAMODE mode = '0';");
         mode = '0';
       }
       else{
         mode = '0';
         Serial.println("Quit YUSHAMODE mode = 0;");
       }
       break;
     }
 
     case '7':{//GrootひさBlue
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("Groooootモード");
       Serial.println("REALLY? y or n");
       char rcv = SerialWaitRead();
       Serial_flush();
       if(rcv =='y'){
         sendResponce();
         GROOOOOOTMODE();
         Serial.println("Quit GROOOOOOTMODE mode = '0';");
         mode = '0';
       }
       else{
         mode = '0';
         Serial.println("Quit GROOOOOOTMODE mode = 0;");
       }
       break;
     }
 
     case '8':{//LOLLIPOPモード
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("ロリポップモード");
       Serial.println("REALLY? y or n");
       char rcv = SerialWaitRead();
       if(rcv =='y'){
         LOLLIPOPMODE();
         Serial.println("Quit LOLLIPOPMODE mode = '0';");
         mode = '0';
       }
       else{
         mode = '0';
         Serial.println("Quit LOLLIPOPMODE mode = 0;");
       }
       break;
     }
 
     case '9':{//LEAKモード
       Serial.println();
       Serial.println();
       Serial.println();
       Serial.println("LEAKモード");
       Serial.println("REALLY? y or n");
       char rcv = SerialWaitRead();
       if(rcv =='y'){
         LEAKMODE();
         Serial.println("Quit LEAKMODE mode = '0';");
         mode = '0';
       }
       else{
         mode = '0';
         Serial.println("Quit LEAKMODE mode = 0;");
       }
     }
       
     case 0x20:{//fadeChangeテスト
       Serial.println("0x20 space mode Selected.");
       Serial.println("Send colors: ");
       Serial.println("        red: r");
       Serial.println("       blue: b");
       Serial.println("      green: g");
       Serial.println("     orange: o");
       Serial.println("     yellow: y");
       Serial.println("     pink  : p");
       Serial.println("      white: w");
       Serial.println("        off: Space bar");
       Serial.println();
       Serial.println("       quit: q");
       char rcv;
       spacemode = true;
       while(spacemode){
        rcv = SerialWaitRead();
        Serial_flush();
        if( rcv == 'q' ){
          spacemode = false;
          Serial_flush();
          mode = '0';
        }
        else if( rcv == 'r' ){
          fadeChange(255, 0, 0, 1);
          Serial_flush();
          // Red
        }
        else if( rcv == 'g' ){
          fadeChange(0, 255, 0, 1);
          Serial_flush();
          // Green
        }
        else if( rcv == 'b' ){
          fadeChange(0, 0, 255, 1);
          Serial_flush();
          // Blue
        }
        else if( rcv == 'o' ){
          fadeChange(255, 55, 0, 1);
          Serial_flush();
          // Orange
        }
        else if( rcv == 'y' ){
          fadeChange(255, 255, 0, 1);
          Serial_flush();
          // Yellow
        }
        else if( rcv == 'w' ){
          fadeChange(254, 254, 254, 1);
          Serial_flush();
          // White
        }
        else if( rcv == 'p' ){
          fadeChange(255, 0, 255, 1);
          Serial_flush();
          //pink
        }
        else if( rcv == 0x20 ){
          fadeAllOff(6);
          Serial_flush();
        }
        else if( rcv == 'q' ){
          patAllOff();
          Serial_flush();
          spacemode = false;
          mode = '0';
          //pink
        }
        
      }
       Serial.println("Exit Spacemode");
       mode = '0';
       Serial.println("mode = 0x30");
       Serial.println(mode);
       break;
     }

     default:{
       Serial_flush();
       mode = '0';
       break;
     }

   }
 }
 